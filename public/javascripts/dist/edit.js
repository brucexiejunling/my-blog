/*! blog 2014-08-28 */
function init(){$("div.title-wrapper input").val($("div.data-holder .title").html()),$("div.tags-wrapper input").val($("div.data-holder .tags").html()),$("div.type-wrapper select").val($("div.data-holder .type").html()),bkLib.onDomLoaded(function(){new nicEditor({fullPanel:!0}).panelInstance("area2"),$("div.nicEdit-main").on("dblclick",function(a){var b=a||window.event;"img"===b.target.nodeName.toLowerCase()&&$(b.target).toggleClass("active")}),addExtraFeatures()})}function addExtraFeatures(){var a=$('<div class="add-border extra-feature" title="加边框">口</div>'),b=$('<div class="up extra-feature" title="放大图片">+</div>'),c=$('<div class="down extra-feature" title="缩小图片">-</div>');a.click(addBorder),b.click(scaleUp),c.click(scaleDown),$("div.nicEdit-panel").append(a).append(b).append(c)}function addBorder(){var a=$("img.active");a[0]?a.hasClass("border")?(a.removeClass("border"),a.css("border","none")):(a.addClass("border"),a.css("border","solid 5px #fff")):alert("请先选择图片~~")}function scaleUp(){var a=$("img.active");a[0]?(a.css("width",1.1*a.width()),a.css("height",1.1*a.height())):alert("请先选择图片~~")}function scaleDown(){var a=$("img.active");a[0]?(a.css("width",.9*a.width()),a.css("height",.9*a.height())):alert("请先选择图片~~")}function listenEndBtnsClickEvent(){$("div.end-buttons button.cancel").click(function(){location.href="/"}),$("div.end-buttons button.save").click(function(){validate()?saveNewArticle():alert("请完成输入！")})}function validate(){var a=tagValid=contentValid=!1;$.trim($("div.title-wrapper input").val())&&(a=!0);var b=$("div.tags-wrapper input"),c=$("div.type-wrapper select");return tagValid="tech"!==c.val()||$.trim(b.val())?!0:!1,$.trim($("div.nicEdit-main").text()).length>50&&(contentValid=!0),a&&tagValid&&contentValid}function saveNewArticle(){var a=$("div.data-holder .aid").html(),b=$.trim($("div.title-wrapper input").val()),c=$.trim($("div.tags-wrapper input").val()).split(" "),d=$("div.type-wrapper select").val(),e=$.trim($("div.nicEdit-main").html()),f=$.trim($("div.nicEdit-main").text()),g={aid:a,title:b,type:d,tags:c,contentHtml:e,contentText:f};$.post("/article",g,function(a){""===a.error?location.href="/article/"+a.article._id:alert(a.error)})}$(function(){init(),listenEndBtnsClickEvent()});